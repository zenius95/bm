</main>
    </div>
</div>

<div id="toast-container" class="fixed top-5 right-5 z-50 w-full max-w-xs space-y-3"></div>

<%# === HỆ THỐNG MODAL XÁC NHẬN CHUNG === %>
<div id="custom-modal-backdrop" class="fixed inset-0 bg-gray-950/70 backdrop-blur-sm z-[99] hidden transition-opacity duration-300 ease-in-out opacity-0"></div>
<div id="custom-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[100] w-full max-w-md p-4 hidden transform transition-all duration-300 ease-in-out scale-95 opacity-0">
    <div class="bg-gray-900/80 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl shadow-black/20">
        <div class="p-6">
            <div class="flex items-start gap-4">
                <div id="modal-icon-container" class="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0">
                    <i id="modal-icon" class="ri-lg"></i>
                </div>
                <div>
                    <h3 id="modal-title" class="text-xl font-bold text-white"></h3>
                     <p id="modal-message" class="mt-1 text-gray-300 text-sm"></p>
                </div>
            </div>
        </div>
        <div id="modal-actions" class="px-6 py-4 bg-white/5 rounded-b-2xl flex justify-end items-center gap-3">
        </div>
    </div>
</div>

<%# === MODAL CHI TIẾT DOANH THU (ĐÃ DI CHUYỂN VÀO ĐÂY) === %>
<div id="chart-details-modal" class="modal-container fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[100] w-full max-w-4xl p-4 hidden transform transition-all duration-300 ease-in-out scale-95 opacity-0">
    <div class="bg-gray-900/95 border border-white/10 rounded-2xl shadow-2xl shadow-black/20 flex flex-col" style="height: 80vh;">
        <div class="p-6 border-b border-white/10 flex justify-between items-center flex-shrink-0">
            <div>
                <h3 class="text-xl font-bold text-white">Chi tiết Doanh thu</h3>
                <p id="modal-date-range" class="text-sm text-gray-400 mt-1"></p>
            </div>
            <button class="btn-cancel p-2 rounded-md hover:bg-white/10 text-gray-400 transition"><i class="ri-close-line ri-lg"></i></button>
        </div>
        <div class="p-4 flex-grow overflow-y-auto">
            <table class="w-full text-sm text-left text-gray-300">
                <thead class="text-xs text-gray-400 uppercase bg-white/10 sticky top-0 backdrop-blur-sm">
                    <tr>
                        <th scope="col" class="px-6 py-3">Thời gian</th>
                        <th scope="col" class="px-6 py-3">Người dùng</th>
                        <th scope="col" class="px-6 py-3">Hành động</th>
                        <th scope="col" class="px-6 py-3 text-right">Số tiền</th>
                    </tr>
                </thead>
                <tbody id="chart-details-tbody" class="divide-y divide-white/10">
                    <%# Dữ liệu sẽ được chèn vào đây bằng JavaScript %>
                </tbody>
            </table>
        </div>
    </div>
</div>


<script src="/socket.io/socket.io.js"></script>
<script src="/js/main.js"></script>
<script>
    <% if (user) { %>
        const userSocket = io();
        userSocket.on('connect', () => {
            const userRoom = 'user_<%= user._id %>';
            userSocket.emit('join_room', userRoom);
        });
        userSocket.on('deposit:success', (data) => {
            const formattedAmount = Number(data.amount).toLocaleString('vi-VN');
            const message = `Tài khoản của bạn vừa được cộng ${formattedAmount}đ.`;
            const title = 'Nạp tiền thành công!';
            showToast(message, title, 'success', 10000);

            const userMenuBalance = document.querySelector('#user-menu-container .text-yellow-400');
            if (userMenuBalance) {
                userMenuBalance.textContent = Number(data.newBalance).toLocaleString('vi-VN') + 'đ';
            }
        });
    <% } %>
</script>
</body>
</html>